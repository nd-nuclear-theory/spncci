/****************************************************************
  lgi_solver.h

  Interface for lsu3shell basis.
                                  
  Anna E. McCoy and Mark A. Caprio
  University of Notre Dame

  8/1/16 (aem,mac): Created.
  9/7/16 (mac): Split from lsu3shell_interface.
  ...
  1/19/17 (mac): Replace null solver.
  2/17/17 (mac):
    - Remove internal function GenerateBrelNcmMatrices from header.
    - Remove leftover function declaration GenerateNcmMatrixVector
      from header.
    - Change GenerateLGIExpansion to take matrices rather than
      streams.
    - Extract WriteLGILabels to lgi.h.
  6/11/17 (mac): Remove deprecated form of GenerateLGIExpansion with
    stream arguments.
  10/11/17 (aem) : Extract GetLGIExpansion from spncci/computation_control
  2/8/18 (aem) : removed lgi_families with gamma_max=0
****************************************************************/

#ifndef LGI_PROB_H_
#define LGI_PROB_H_

#include <vector>
#include <eigen3/Eigen/Eigen>

#include "am/am.h"  
#include "lgi/lgi.h"
#include "lsu3shell/lsu3shell_rme.h"

namespace lgi
{

  void 
    GenerateLGIExpansion(
        const u3shell::SpaceU3SPN& space, 
        const u3shell::SectorsU3SPN& Brel_sectors,
        const basis::MatrixVector& Brel_matrices,
        const u3shell::SectorsU3SPN& Ncm_sectors,
        const basis::MatrixVector& Ncm_matrices,
        HalfInt Nsigma_0,
        lgi::MultiplicityTaggedLGIVector& lgi_families,
        basis::MatrixVector& lgi_expansions,
        std::vector<int>& lsu3shell_index_lookup_table
      );
  // Generate the LGI Expansion in terms of lsu3shell SU(3)xSU(2)
  // reduced basis states by solving for the null space of the
  // Brel+Ncm matrix.
  // 
  //  lsu3_basis_table and space are generated as output from lsu3shell::ReadLSU3ShellBasis
  //  which reads in basis table generated by ncsmSU3xSU2BasisLSU3Tabular
  //
  // Construct Brel and Ncm matrix in lsu3shell basis and solve for null space.
  // Columns of kernel are expansion coefficients for each lgi.
  //
  // lsu3hsell_index_lookup_table: look up take relating lsu3shell subspace index to lgi family index


void GetLGIExpansion(
    const u3shell::SpaceU3SPN& lsu3shell_space, 
    const lsu3shell::LSU3ShellBasisTable& lsu3shell_basis_table,
    const std::string& Brel_filename,
    const std::string& Nrel_filename,
    int A, HalfInt Nsigma_0,
    lgi::MultiplicityTaggedLGIVector& lgi_families,
    lsu3shell::OperatorBlocks& lgi_expansions,
    std::vector<int>& lsu3shell_index_lookup_table
  );
  // Get list of LGI labels, multiplicities and expansion in lsu3shell basis
  //
  // Inputs
  //  lsu3shell_basis_table,lsu3shell_space,  Filenames and A
  // 
  // Outputs 
  //   lgi::MultiplicityTaggedLGIVector lgi_families;
  //    basis::MatrixVector lgi_expansions;
  //    lsu3hsell_index_lookup_table: look up take relating 
  //      lsu3shell subspace index to lgi family index

  void
    TransformOperatorToSpBasis(
        const u3shell::SectorsU3SPN& sectors,
        const basis::MatrixVector& basis_transformation_matrices,
        const basis::MatrixVector& lsu3shell_operator_matrices,
        basis::MatrixVector& spncci_operator_matrices
      );
  // Similarity transformation from LSU3shell basis to Sp(3,R)xSU(2) basis

}
#endif
